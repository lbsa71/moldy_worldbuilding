<!-- src/components/Game.astro -->
---
---
<div class="game-container">
    <canvas id="gameCanvas"></canvas>
    <div id="statsOverlay">
        <div>Renderer: <span id="rendererType">Loading...</span></div>
        <div>FPS: <span id="fpsCounter">0</span></div>
    </div>
</div>

<script>
    // WASM module type definition
    interface WasmExports {
        calculatePhysics: (x: number, y: number, z: number) => number;
    }

    // Simple WASM loader
    async function loadWasm() {
        try {
            const response = await fetch('/wasm/release.wasm');
            const bytes = await response.arrayBuffer();
            const { instance } = await WebAssembly.instantiate(bytes);
            const exports = instance.exports as unknown as WasmExports;
            window.calculatePhysics = exports.calculatePhysics;
            console.log('WASM loaded successfully');
            return true;
        } catch (error) {
            console.error('Failed to load WASM:', error);
            return false;
        }
    }

    // Import and initialize game
    const initGame = async () => {
        try {
            const { GameScene } = await import('./GameScene');
            
            // Load WASM first
            await loadWasm();
            
            const canvas = document.getElementById('gameCanvas') as HTMLCanvasElement;
            if (canvas) {
                const game = new GameScene(canvas);
                await game.run();
                
                // Update renderer type
                const rendererType = document.getElementById('rendererType');
                if (rendererType) {
                    rendererType.textContent = game.getRendererType();
                }

                // Update FPS counter
                const fpsCounter = document.getElementById('fpsCounter');
                if (fpsCounter) {
                    setInterval(() => {
                        fpsCounter.textContent = game.getFps().toFixed(0);
                    }, 1000);
                }
            }
        } catch (error) {
            console.error('Failed to initialize game:', error);
        }
    };

    // Wait for window load before initializing
    window.addEventListener('load', initGame);
</script>

<style>
    .game-container {
        width: 100%;
        height: 100vh;
        position: relative;
    }
    
    #gameCanvas {
        width: 100%;
        height: 100%;
        touch-action: none;
    }

    #statsOverlay {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        font-size: 14px;
        pointer-events: none;
    }
</style>
